# PATCH: Update handleEndMeetingFromFollowUp to use new /api/meetings/active endpoint

## Find this function in TrackingEmployee/client/pages/Tracking.tsx (around line 327)

Replace the ENTIRE `handleEndMeetingFromFollowUp` function with this new version:

```typescript
const handleEndMeetingFromFollowUp = async (followUpId: string, meetingId: string) => {
  console.log("üî¥ handleEndMeetingFromFollowUp called with:", { followUpId, meetingId });
  
  // üîπ NEW APPROACH: Use dedicated API endpoint to get active meeting from DATABASE
  console.log("üì• Fetching active meeting from dedicated API endpoint (database)...");
  toast({
    title: "Loading Meeting Data",
    description: "Please wait...",
  });
  
  let finalMeetingId = meetingId;
  let activeMeetingData: MeetingLog | null = null;
  
  try {
    // üîπ STEP 1: Use the new dedicated endpoint to get active meeting from DATABASE
    // This is more reliable than relying on React state which gets lost on tab close
    if (!finalMeetingId || finalMeetingId === "") {
      console.log("üîç Calling /api/meetings/active endpoint...");
      
      // Try by followUpId first (most specific)
      if (followUpId) {
        try {
          const response = await HttpClient.get(
            `/api/meetings/active?followUpId=${followUpId}`
          );
          
          if (response.ok) {
            activeMeetingData = await response.json();
            finalMeetingId = activeMeetingData.id;
            console.log("‚úÖ Found active meeting by followUpId from DATABASE:", finalMeetingId);
          } else {
            console.warn("‚ö†Ô∏è No active meeting found with followUpId:", followUpId);
          }
        } catch (error) {
          console.warn("‚ö†Ô∏è Error fetching by followUpId:", error);
        }
      }
      
      // If not found by followUpId, try by employeeId
      if (!finalMeetingId && employeeId) {
        try {
          const response = await HttpClient.get(
            `/api/meetings/active?employeeId=${employeeId}`
          );
          
          if (response.ok) {
            activeMeetingData = await response.json();
            finalMeetingId = activeMeetingData.id;
            console.log("‚úÖ Found active meeting by employeeId from DATABASE:", finalMeetingId);
          } else {
            console.warn("‚ö†Ô∏è No active meeting found for employee:", employeeId);
          }
        } catch (error) {
          console.warn("‚ö†Ô∏è Error fetching by employeeId:", error);
        }
      }
    }
    
    // üîπ STEP 2: If we still don't have a meeting ID, show error
    if (!finalMeetingId || finalMeetingId === "") {
      console.error("‚ùå No active meeting found in DATABASE!");
      toast({
        title: "No Active Meeting",
        description: "No active meeting found. Please start a meeting first.",
        variant: "destructive",
      });
      return;
    }
    
    console.log("üéØ Final meeting ID from DATABASE:", finalMeetingId);
    
    // üîπ STEP 3: Update local state with the active meeting from DATABASE
    if (activeMeetingData) {
      // Update meetings array if needed
      setMeetings(prev => {
        const exists = prev.find(m => m.id === activeMeetingData!.id);
        if (!exists) {
          return [activeMeetingData!, ...prev];
        }
        return prev;
      });
      
      // Restore startedMeetingMap from DATABASE data
      if (activeMeetingData.followUpId) {
        console.log("üîÑ Restoring startedMeetingMap from DATABASE:", {
          [activeMeetingData.followUpId]: activeMeetingData.id
        });
        setStartedMeetingMap(prev => ({
          ...prev,
          [activeMeetingData!.followUpId!]: activeMeetingData!.id
        }));
      }
    }
    
    // üîπ STEP 4: Get follow-up data for the modal
    let followUpData = followUpDataMap[finalMeetingId];
    
    if (!followUpData && followUpId) {
      followUpData = todaysFollowUpMeetings.find(m => m._id === followUpId);
    }
    
    if (!followUpData && activeMeetingData?.followUpId) {
      followUpData = todaysFollowUpMeetings.find(m => m._id === activeMeetingData.followUpId);
    }
    
    if (followUpData) {
      console.log("‚úÖ Setting follow-up data for modal:", followUpData);
      setStartedFollowUpData(followUpData);
    } else {
      console.warn("‚ö†Ô∏è No follow-up data found for meeting:", finalMeetingId);
    }
    
    // üîπ STEP 5: Open the modal
    setActiveMeetingId(finalMeetingId);
    setIsEndMeetingModalOpen(true);
    
  } catch (error) {
    console.error("‚ùå Error in handleEndMeetingFromFollowUp:", error);
    toast({
      title: "Error",
      description: "Failed to load meeting data. Please try again.",
        variant: "destructive",
    });
  }
};
```

## Key Changes:
1. Uses new `/api/meetings/active` endpoint instead of `/api/meetings?employeeId=...`
2. Queries DATABASE directly for active meetings (not React state)
3. More reliable - works even after browser tab close
4. Simpler logic - dedicated endpoint does the filtering
